{"id":"node_modules/@tensorflow-models/blazeface/face.js","dependencies":[{"name":"/workspace/tfjs-models/blazeface/demo/node_modules/@tensorflow-models/blazeface/face.js.map","includedInParent":true,"mtime":1618935904000},{"name":"/workspace/tfjs-models/blazeface/demo/package.json","includedInParent":true,"mtime":1618943620505},{"name":"/workspace/tfjs-models/blazeface/demo/.babelrc","includedInParent":true,"mtime":1618934647000},{"name":"@tensorflow/tfjs-core","loc":{"line":54,"column":17},"parent":"/workspace/tfjs-models/blazeface/demo/node_modules/@tensorflow-models/blazeface/face.js","resolved":"/workspace/tfjs-models/blazeface/demo/node_modules/@tensorflow/tfjs-core/dist/index.js"},{"name":"./box","loc":{"line":55,"column":20},"parent":"/workspace/tfjs-models/blazeface/demo/node_modules/@tensorflow-models/blazeface/face.js","resolved":"/workspace/tfjs-models/blazeface/demo/node_modules/@tensorflow-models/blazeface/box.js"}],"generated":{"js":"\"use strict\";\n/**\n * @license\n * Copyright 2019 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n * =============================================================================\n */\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar tf = require(\"@tensorflow/tfjs-core\");\nvar box_1 = require(\"./box\");\nvar ANCHORS_CONFIG = {\n    'strides': [8, 16],\n    'anchors': [2, 6]\n};\n// `NUM_LANDMARKS` is a fixed property of the model.\nvar NUM_LANDMARKS = 6;\nfunction generateAnchors(width, height, outputSpec) {\n    var anchors = [];\n    for (var i = 0; i < outputSpec.strides.length; i++) {\n        var stride = outputSpec.strides[i];\n        var gridRows = Math.floor((height + stride - 1) / stride);\n        var gridCols = Math.floor((width + stride - 1) / stride);\n        var anchorsNum = outputSpec.anchors[i];\n        for (var gridY = 0; gridY < gridRows; gridY++) {\n            var anchorY = stride * (gridY + 0.5);\n            for (var gridX = 0; gridX < gridCols; gridX++) {\n                var anchorX = stride * (gridX + 0.5);\n                for (var n = 0; n < anchorsNum; n++) {\n                    anchors.push([anchorX, anchorY]);\n                }\n            }\n        }\n    }\n    return anchors;\n}\nfunction decodeBounds(boxOutputs, anchors, inputSize) {\n    var boxStarts = tf.slice(boxOutputs, [0, 1], [-1, 2]);\n    var centers = tf.add(boxStarts, anchors);\n    var boxSizes = tf.slice(boxOutputs, [0, 3], [-1, 2]);\n    var boxSizesNormalized = tf.div(boxSizes, inputSize);\n    var centersNormalized = tf.div(centers, inputSize);\n    var halfBoxSize = tf.div(boxSizesNormalized, 2);\n    var starts = tf.sub(centersNormalized, halfBoxSize);\n    var ends = tf.add(centersNormalized, halfBoxSize);\n    var startNormalized = tf.mul(starts, inputSize);\n    var endNormalized = tf.mul(ends, inputSize);\n    var concatAxis = 1;\n    return tf.concat2d([startNormalized, endNormalized], concatAxis);\n}\nfunction getInputTensorDimensions(input) {\n    return input instanceof tf.Tensor ? [input.shape[0], input.shape[1]] :\n        [input.height, input.width];\n}\nfunction flipFaceHorizontal(face, imageWidth) {\n    var flippedTopLeft, flippedBottomRight, flippedLandmarks;\n    if (face.topLeft instanceof tf.Tensor &&\n        face.bottomRight instanceof tf.Tensor) {\n        var _a = tf.tidy(function () {\n            return [\n                tf.concat([\n                    tf.slice(tf.sub(imageWidth - 1, face.topLeft), 0, 1),\n                    tf.slice(face.topLeft, 1, 1)\n                ]),\n                tf.concat([\n                    tf.sub(imageWidth - 1, tf.slice(face.bottomRight, 0, 1)),\n                    tf.slice(face.bottomRight, 1, 1)\n                ])\n            ];\n        }), topLeft = _a[0], bottomRight = _a[1];\n        flippedTopLeft = topLeft;\n        flippedBottomRight = bottomRight;\n        if (face.landmarks != null) {\n            flippedLandmarks = tf.tidy(function () {\n                var a = tf.sub(tf.tensor1d([imageWidth - 1, 0]), face.landmarks);\n                var b = tf.tensor1d([1, -1]);\n                var product = tf.mul(a, b);\n                return product;\n            });\n        }\n    }\n    else {\n        var _b = face.topLeft, topLeftX = _b[0], topLeftY = _b[1];\n        var _c = face.bottomRight, bottomRightX = _c[0], bottomRightY = _c[1];\n        flippedTopLeft = [imageWidth - 1 - topLeftX, topLeftY];\n        flippedBottomRight = [imageWidth - 1 - bottomRightX, bottomRightY];\n        if (face.landmarks != null) {\n            flippedLandmarks =\n                face.landmarks.map(function (coord) { return ([\n                    imageWidth - 1 - coord[0],\n                    coord[1]\n                ]); });\n        }\n    }\n    var flippedFace = {\n        topLeft: flippedTopLeft,\n        bottomRight: flippedBottomRight\n    };\n    if (flippedLandmarks != null) {\n        flippedFace.landmarks = flippedLandmarks;\n    }\n    if (face.probability != null) {\n        flippedFace.probability = face.probability instanceof tf.Tensor ?\n            face.probability.clone() :\n            face.probability;\n    }\n    return flippedFace;\n}\nfunction scaleBoxFromPrediction(face, scaleFactor) {\n    return tf.tidy(function () {\n        var box;\n        if (face.hasOwnProperty('box')) {\n            box = face.box;\n        }\n        else {\n            box = face;\n        }\n        return tf.squeeze(box_1.scaleBox(box, scaleFactor).startEndTensor);\n    });\n}\nvar BlazeFaceModel = /** @class */ (function () {\n    function BlazeFaceModel(model, width, height, maxFaces, iouThreshold, scoreThreshold) {\n        this.blazeFaceModel = model;\n        this.width = width;\n        this.height = height;\n        this.maxFaces = maxFaces;\n        this.anchorsData = generateAnchors(width, height, ANCHORS_CONFIG);\n        this.anchors = tf.tensor2d(this.anchorsData);\n        this.inputSizeData = [width, height];\n        this.inputSize = tf.tensor1d([width, height]);\n        this.iouThreshold = iouThreshold;\n        this.scoreThreshold = scoreThreshold;\n    }\n    BlazeFaceModel.prototype.getBoundingBoxes = function (inputImage, returnTensors, annotateBoxes) {\n        if (annotateBoxes === void 0) { annotateBoxes = true; }\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, detectedOutputs, boxes, scores, savedConsoleWarnFn, boxIndicesTensor, boxIndices, boundingBoxes, originalHeight, originalWidth, scaleFactor, annotatedBoxes, _loop_1, i;\n            var _this = this;\n            return __generator(this, function (_b) {\n                switch (_b.label) {\n                    case 0:\n                        _a = tf.tidy(function () {\n                            var resizedImage = tf.image.resizeBilinear(inputImage, [_this.width, _this.height]);\n                            var normalizedImage = tf.mul(tf.sub(tf.div(resizedImage, 255), 0.5), 2);\n                            // [1, 897, 17] 1 = batch, 897 = number of anchors\n                            var batchedPrediction = _this.blazeFaceModel.predict(normalizedImage);\n                            var prediction = tf.squeeze(batchedPrediction);\n                            var decodedBounds = decodeBounds(prediction, _this.anchors, _this.inputSize);\n                            var logits = tf.slice(prediction, [0, 0], [-1, 1]);\n                            var scores = tf.squeeze(tf.sigmoid(logits));\n                            return [prediction, decodedBounds, scores];\n                        }), detectedOutputs = _a[0], boxes = _a[1], scores = _a[2];\n                        savedConsoleWarnFn = console.warn;\n                        console.warn = function () { };\n                        boxIndicesTensor = tf.image.nonMaxSuppression(boxes, scores, this.maxFaces, this.iouThreshold, this.scoreThreshold);\n                        console.warn = savedConsoleWarnFn;\n                        return [4 /*yield*/, boxIndicesTensor.array()];\n                    case 1:\n                        boxIndices = _b.sent();\n                        boxIndicesTensor.dispose();\n                        boundingBoxes = boxIndices.map(function (boxIndex) { return tf.slice(boxes, [boxIndex, 0], [1, -1]); });\n                        if (!!returnTensors) return [3 /*break*/, 3];\n                        return [4 /*yield*/, Promise.all(boundingBoxes.map(function (boundingBox) { return __awaiter(_this, void 0, void 0, function () {\n                                var vals;\n                                return __generator(this, function (_a) {\n                                    switch (_a.label) {\n                                        case 0: return [4 /*yield*/, boundingBox.array()];\n                                        case 1:\n                                            vals = _a.sent();\n                                            boundingBox.dispose();\n                                            return [2 /*return*/, vals];\n                                    }\n                                });\n                            }); }))];\n                    case 2:\n                        boundingBoxes = _b.sent();\n                        _b.label = 3;\n                    case 3:\n                        originalHeight = inputImage.shape[1];\n                        originalWidth = inputImage.shape[2];\n                        if (returnTensors) {\n                            scaleFactor = tf.div([originalWidth, originalHeight], this.inputSize);\n                        }\n                        else {\n                            scaleFactor = [\n                                originalWidth / this.inputSizeData[0],\n                                originalHeight / this.inputSizeData[1]\n                            ];\n                        }\n                        annotatedBoxes = [];\n                        _loop_1 = function (i) {\n                            var boundingBox = boundingBoxes[i];\n                            var annotatedBox = tf.tidy(function () {\n                                var box = boundingBox instanceof tf.Tensor ?\n                                    box_1.createBox(boundingBox) :\n                                    box_1.createBox(tf.tensor2d(boundingBox));\n                                if (!annotateBoxes) {\n                                    return box;\n                                }\n                                var boxIndex = boxIndices[i];\n                                var anchor;\n                                if (returnTensors) {\n                                    anchor = tf.slice(_this.anchors, [boxIndex, 0], [1, 2]);\n                                }\n                                else {\n                                    anchor = _this.anchorsData[boxIndex];\n                                }\n                                var landmarks = tf.reshape(tf.squeeze(tf.slice(detectedOutputs, [boxIndex, NUM_LANDMARKS - 1], [1, -1])), [NUM_LANDMARKS, -1]);\n                                var probability = tf.slice(scores, [boxIndex], [1]);\n                                return { box: box, landmarks: landmarks, probability: probability, anchor: anchor };\n                            });\n                            annotatedBoxes.push(annotatedBox);\n                        };\n                        for (i = 0; i < boundingBoxes.length; i++) {\n                            _loop_1(i);\n                        }\n                        boxes.dispose();\n                        scores.dispose();\n                        detectedOutputs.dispose();\n                        return [2 /*return*/, {\n                                boxes: annotatedBoxes,\n                                scaleFactor: scaleFactor\n                            }];\n                }\n            });\n        });\n    };\n    /**\n     * Returns an array of faces in an image.\n     *\n     * @param input The image to classify. Can be a tensor, DOM element image,\n     * video, or canvas.\n     * @param returnTensors (defaults to `false`) Whether to return tensors as\n     * opposed to values.\n     * @param flipHorizontal Whether to flip/mirror the facial keypoints\n     * horizontally. Should be true for videos that are flipped by default (e.g.\n     * webcams).\n     * @param annotateBoxes (defaults to `true`) Whether to annotate bounding\n     * boxes with additional properties such as landmarks and probability. Pass in\n     * `false` for faster inference if annotations are not needed.\n     *\n     * @return An array of detected faces, each with the following properties:\n     *  `topLeft`: the upper left coordinate of the face in the form `[x, y]`\n     *  `bottomRight`: the lower right coordinate of the face in the form `[x, y]`\n     *  `landmarks`: facial landmark coordinates\n     *  `probability`: the probability of the face being present\n     */\n    BlazeFaceModel.prototype.estimateFaces = function (input, returnTensors, flipHorizontal, annotateBoxes) {\n        if (returnTensors === void 0) { returnTensors = false; }\n        if (flipHorizontal === void 0) { flipHorizontal = false; }\n        if (annotateBoxes === void 0) { annotateBoxes = true; }\n        return __awaiter(this, void 0, void 0, function () {\n            var _a, width, image, _b, boxes, scaleFactor;\n            var _this = this;\n            return __generator(this, function (_c) {\n                switch (_c.label) {\n                    case 0:\n                        _a = getInputTensorDimensions(input), width = _a[1];\n                        image = tf.tidy(function () {\n                            if (!(input instanceof tf.Tensor)) {\n                                input = tf.browser.fromPixels(input);\n                            }\n                            return tf.expandDims(tf.cast(input, 'float32'), 0);\n                        });\n                        return [4 /*yield*/, this.getBoundingBoxes(image, returnTensors, annotateBoxes)];\n                    case 1:\n                        _b = _c.sent(), boxes = _b.boxes, scaleFactor = _b.scaleFactor;\n                        image.dispose();\n                        if (returnTensors) {\n                            return [2 /*return*/, boxes.map(function (face) {\n                                    var scaledBox = scaleBoxFromPrediction(face, scaleFactor);\n                                    var normalizedFace = {\n                                        topLeft: tf.slice(scaledBox, [0], [2]),\n                                        bottomRight: tf.slice(scaledBox, [2], [2])\n                                    };\n                                    if (annotateBoxes) {\n                                        var _a = face, landmarks = _a.landmarks, probability = _a.probability, anchor = _a.anchor;\n                                        var normalizedLandmarks = tf.mul(tf.add(landmarks, anchor), scaleFactor);\n                                        normalizedFace.landmarks = normalizedLandmarks;\n                                        normalizedFace.probability = probability;\n                                    }\n                                    if (flipHorizontal) {\n                                        normalizedFace = flipFaceHorizontal(normalizedFace, width);\n                                    }\n                                    return normalizedFace;\n                                })];\n                        }\n                        return [2 /*return*/, Promise.all(boxes.map(function (face) { return __awaiter(_this, void 0, void 0, function () {\n                                var scaledBox, normalizedFace, boxData, _a, landmarkData, boxData, probabilityData, anchor_1, _b, scaleFactorX_1, scaleFactorY_1, scaledLandmarks;\n                                var _this = this;\n                                return __generator(this, function (_c) {\n                                    switch (_c.label) {\n                                        case 0:\n                                            scaledBox = scaleBoxFromPrediction(face, scaleFactor);\n                                            if (!!annotateBoxes) return [3 /*break*/, 2];\n                                            return [4 /*yield*/, scaledBox.array()];\n                                        case 1:\n                                            boxData = _c.sent();\n                                            normalizedFace = {\n                                                topLeft: boxData.slice(0, 2),\n                                                bottomRight: boxData.slice(2)\n                                            };\n                                            return [3 /*break*/, 4];\n                                        case 2: return [4 /*yield*/, Promise.all([face.landmarks, scaledBox, face.probability].map(function (d) { return __awaiter(_this, void 0, void 0, function () { return __generator(this, function (_a) {\n                                                return [2 /*return*/, d.array()];\n                                            }); }); }))];\n                                        case 3:\n                                            _a = _c.sent(), landmarkData = _a[0], boxData = _a[1], probabilityData = _a[2];\n                                            anchor_1 = face.anchor;\n                                            _b = scaleFactor, scaleFactorX_1 = _b[0], scaleFactorY_1 = _b[1];\n                                            scaledLandmarks = landmarkData\n                                                .map(function (landmark) { return ([\n                                                (landmark[0] + anchor_1[0]) * scaleFactorX_1,\n                                                (landmark[1] + anchor_1[1]) * scaleFactorY_1\n                                            ]); });\n                                            normalizedFace = {\n                                                topLeft: boxData.slice(0, 2),\n                                                bottomRight: boxData.slice(2),\n                                                landmarks: scaledLandmarks,\n                                                probability: probabilityData\n                                            };\n                                            box_1.disposeBox(face.box);\n                                            face.landmarks.dispose();\n                                            face.probability.dispose();\n                                            _c.label = 4;\n                                        case 4:\n                                            scaledBox.dispose();\n                                            if (flipHorizontal) {\n                                                normalizedFace = flipFaceHorizontal(normalizedFace, width);\n                                            }\n                                            return [2 /*return*/, normalizedFace];\n                                    }\n                                });\n                            }); }))];\n                }\n            });\n        });\n    };\n    return BlazeFaceModel;\n}());\nexports.BlazeFaceModel = BlazeFaceModel;\n"},"sourceMaps":{"js":{"version":3,"file":"face.js","sourceRoot":"","sources":["../src/face.ts"],"names":[],"mappings":"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","sourcesContent":[null]}},"error":null,"hash":"9e12416e2f210b222cb25c9a26cd732d","cacheData":{"env":{}}}